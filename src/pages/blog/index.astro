---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Blog">
  <section class="py-12">
    <h1 class="text-3xl font-bold text-primary mb-8">Blog</h1>

    {posts.length === 0 ? (
      <p class="text-text-muted">No posts yet. Check back soon!</p>
    ) : (
      <div class="grid gap-4 sm:grid-cols-2">
        {posts.map(post => (
          <a href={`${base}blog/${post.id.replace(/\.mdx?$/, '')}/`} class="block bg-surface rounded-lg border border-border p-5 hover:border-primary/50 transition-colors">
            <time class="text-xs text-text-muted">
              {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <h3 class="text-lg font-semibold mt-1 mb-2">{post.data.title}</h3>
            <p class="text-sm text-text-muted leading-relaxed">{post.data.description}</p>
          </a>
        ))}
      </div>
    )}
  </section>
</BaseLayout>
